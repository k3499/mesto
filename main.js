!function(){"use strict";class e{constructor(e,t,s,r,n,i){this.title=t.name,this.img=t.link,this._selector=s,this._handleCardClick=r,this._handleDelete=n,this.countLike=t.likes.length,this.id=t._id,this._owner=t.owner,this._handleLike=i,this._selfId=e,this._likes=t.likes}_getTemplate(){return document.querySelector(this._selector).content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._element.querySelector(".element__like").addEventListener("click",(()=>this._handleLike(this,this._element.querySelector(".element__like").classList.contains("element__like_active")))),this._element.querySelector(".element__delete").addEventListener("click",(()=>{this._handleDelete(this)})),this._element.querySelector(".element__image").addEventListener("click",(()=>{this._handleCardClick()}))}generateCard(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".element__image"),t=this._element.querySelector(".element__title");return e.src=this.img,e.alt=this.title,t.textContent=this.title,this._element.querySelector(".element__like-count").textContent=this.countLike,this._owner._id!==this._selfId&&this._element.querySelector(".element__delete").classList.add("element__delete_disable"),this._likes.some((e=>e._id===this._selfId))&&this.like(),this._element}like(){this._element.querySelector(".element__like").classList.toggle("element__like_active")}likesStatus(e){this._element.querySelector(".element__like-count").textContent=e.likes.length,this.like()}removeCard(){this._element.remove(),this._element=null}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(e,s){t(this,"_showInputError",((e,t)=>{const s=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)})),t(this,"_hideInputError",(e=>{const t=this._formElement.querySelector("#".concat(e.id,"-error"));t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)})),t(this,"_checkInputValidity",(e=>{if(e.validity.valid)this._hideInputError(e);else{const t=e.validationMessage;this._showInputError(e,t)}})),t(this,"_validcheck",(()=>{const e=this._inputList.some((e=>!e.validity.valid)),t=!this._inputList.some((e=>e.value.length>0));return e||t})),t(this,"_toggleButtonState",(()=>{this._validcheck()?(this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._inactiveButtonClass)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._inactiveButtonClass))})),t(this,"_setInputListeners",(()=>{this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))})),this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=s,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}enableValidation(){this._setInputListeners()}clearForm(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}}class r{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._containerSelector=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._containerSelector.prepend(e)}}class n{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".popup__close"),this._handleEscClose=this._handleEscClose.bind(this),this._closePopupOnOverlay=this._closePopupOnOverlay.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}_closePopupOnOverlay(e){e.target.classList.contains("popup")&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popup.addEventListener("click",this._closePopupOnOverlay)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}}class i extends n{constructor(e,t){super(e),this._formSubmitHandler=t,this._form=this._popup.querySelector(".popup__form"),this._inputsList=Array.from(this._popup.querySelectorAll("input")),this._popupButton=this._form.querySelector(".popup__button")}_getInputValues(){const e={};return this._inputsList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._formSubmitHandler(this._getInputValues())}))}close(){super.close(),this._form.reset()}renderLoading(e){e?this._popupButton.textContent="Сохранение...":(this._popupButton.textContent="Сохранить",this.close())}}const o={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},l=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),c=document.querySelector("#profile-form"),h=document.querySelector("#cardForm"),u=c.querySelector("#profileName"),_=c.querySelector("#profileJob"),d=(c.querySelector("#profileJob"),c.querySelector(".popup__button"),document.querySelector(".upd-ava-popup").querySelector("#upd-ava-form")),p=new class{constructor(e){this._url=e.url,this._headers=e.headers}_resOk(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}getInitialCards(){return fetch("".concat(this._url,"cards"),{method:"GET",headers:this._headers}).then((e=>this._resOk(e)))}getUserInfo(){return fetch("".concat(this._url,"users/me"),{method:"GET",headers:this._headers}).then((e=>this._resOk(e)))}setUserInfo(e){return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.job})}).then((e=>this._resOk(e)))}addCard(e){return fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.cardname,link:e.cardlink})}).then((e=>this._resOk(e)))}like(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((e=>this._resOk(e)))}removeLike(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._resOk(e)))}removeCard(e){return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._resOk(e)))}avatarUpl(e){return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>this._resOk(e)))}}({url:"https://mesto.nomoreparties.co/v1/cohort-23/",headers:{authorization:"64388478-85d7-41e7-ab69-a698cc4b7b2e","content-type":"application/json"}});function m(t){const s=new e(f.id,t,".template",(()=>{y.open(s.title,s.img)}),(e=>{k.setSubmitAction((()=>{p.removeCard(t._id).then((e=>{s.removeCard(),k.close()})).catch((e=>{console.log(e)}))})),k.open(e)}),((e,t)=>{t?p.removeLike(e.id).then((e=>s.likesStatus(e))).catch((e=>{console.log(e)})):p.like(e.id).then((e=>s.likesStatus(e))).catch((e=>{console.log(e)}))}));return s}let v={};const f=new class{constructor(e,t,s){this.name=document.querySelector(e),this.descr=document.querySelector(t),this.avatar=document.querySelector(s)}getUserInfo(){return{name:this.name.textContent,descr:this.descr.textContent}}setUserInfo(e){this.name.textContent=e.name,this.descr.textContent=e.about}setAvatarLink(e){this.avatar.src=e}}(".profile__title",".profile__job",".profile__avatar");Promise.all([p.getUserInfo(),p.getInitialCards()]).then((e=>{let[t,s]=e;var n;n=t,f.setUserInfo(n),f.setAvatarLink(n.avatar),f.id=n._id,v=new r({items:s,renderer:e=>{const t=m(e);v.addItem(t.generateCard())}},".elements"),v.renderItems()})).catch((e=>{console.log(e)}));const E=new s(o,h),S=new s(o,c),L=new s(o,d);L.enableValidation(),E.enableValidation(),S.enableValidation();const k=new class extends n{constructor(e){super(e)}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmitCallback()}))}open(e){super.open(),this._cardElement=e}setSubmitAction(e){this._handleSubmitCallback=e}}(".confirm-popup");k.setEventListeners();const y=new class extends n{constructor(e){super(e),this._lightboxImage=this._popup.querySelector(".popup__image"),this._lightboxCaption=this._popup.querySelector(".popup__image-caption")}open(e,t){this._lightboxImage.src=t,this._lightboxImage.alt=e,this._lightboxCaption.textContent=e,super.open()}}(".lightbox",".popup__image",".popup__image-caption");y.setEventListeners();const g=new i(".popup-profile",(e=>{g.renderLoading(!0),p.setUserInfo(e).then((e=>{return t=e,void f.setUserInfo(t);var t})).catch((e=>{console.log(e)})).finally((()=>{g.renderLoading(!1)}))}));g.setEventListeners();const b=new i(".popup-card",(e=>{b.renderLoading(!0),p.addCard(e).then((e=>function(e){const t=m(e);v.addItem(t.generateCard())}(e))).catch((e=>{console.log(e)})).finally((()=>{b.renderLoading(!1)}))}));b.setEventListeners();const C=new i(".upd-ava-popup",(e=>{C.renderLoading(!0),p.avatarUpl(e.avalink).then((e=>{return t=e,void f.setAvatarLink(t.avatar);var t})).catch((e=>{console.log(e)})).finally((()=>{C.renderLoading(!1)}))}));C.setEventListeners(),document.querySelector(".profile__avatar-area").addEventListener("click",(()=>{L.clearForm(),C.open()})),a.addEventListener("click",(()=>{E.clearForm(),b.open()})),l.addEventListener("click",(()=>{const e=f.getUserInfo();u.value=e.name,_.value=e.descr,g.open()}))}();